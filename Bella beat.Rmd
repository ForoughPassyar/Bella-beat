---
title: "Bellabeat"
author: "Forough Passyar"
date: "2024-01-22"
output: html_document
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Ask

1)	Business Task 

Bellabeat is a high-tech fitness company focused on health products catered to women. Technology, like their "Time" Fitbit tracks metrics like calories, steps, sleep and much more.I will use external Fitbit data regarding sleep habits, and make recommendations to the Bellabeat stakeholders on how their consumers can elevate their sleep habits, while driving engagement with the app and smart device. My insights will drive the marketing strategy in a more targeted way.

2)	Key Stakeholders

The key stakeholders are founders: Urška Sršen, the Chief Creative Officer and Sando Mur, the co-founder, mathmetician and key figure in the executive team.The other main stakeholders are the marketing analytics team, which are responsible for analyzing,reporting data, and guiding the company’s marketing strategy. 

3)	Product 

The product that this data analysis will be seeking to improve is the Time (Fitbit) product. It is a seemingly classic piece of jewelery combined with technology that tracks health data like sleep and activity. It connects to the Bellabeat app to empower customers to take charge of their wellness!

# Prepare

1)	Data Sample

The data is open-source available through Kaggle and is in long format. In terms of the ROCCC criteria of good data which entails data being reliable, original, comprehensive, current , and cited, this data ranks low. 

Reliable:The sample is comprised of 30 individuals, so it meets the minimum threshold in statistics for sample size, but it is still small. A larger sample size would make it more generalizable to the population and allow for stabilizing and reducing the variability of the mean.

Original: The respondent data originally came from a survey through Amazon MTurk.The originality is low since it comes from a third-party survey. 

Comprehensive: Qualitaatively the data frames provided are relevent for the analysis that I will do and inform recommendations. 

Current:The data set was updated three years ago and was collected between March 12,2016 to May 12,2016. The health and technology space has shifted significantly in the last 7 years so the data seems outdated. 

Cited:Fitbit Fitness Tracker Data (CC0: Public Domain, dataset made available through Mobius). It is comprised of 30 Fitbit users data and includes metrics like heart rate, daily steps, activity, and sleep. Furthermore, the data was pre-processed and contains a sample size of 30. 
 
2)	Limitations of Data

The fitness tracker for Bellabeat is specifically catered to females, yet the Fitbit data that I am analyzing does not specify for sex. Consequently, there are limitations to how one can generalize to the Bellabeat consumer population. The other limitation of the data is small sample size. After I cleaned the data the sample of distinct users was reduced to 24 which is not large enough of a sample size.As far as I am aware, there are no other bias issues. Thus, the insights derived from this analysis should be taken with these qualifications in mind. 

# Process

1) Install packages

```{r}
install.packages("tidyverse")
```

2) Loading packages

```{r}
library(tidyverse)
library(dplyr)
library(tidyr)
library(lubridate)

```

3) I imported files through the history pane of posit Cloud and engaged in exploratory analysis. 

```{r}
sleepDay_merged <- read_csv("/cloud/project/Bellabeat/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv") 
```

```{r}
dailyActivity_merged <- read.csv("/cloud/project/Bellabeat/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv") 
```

```{r}
dailySteps_merged <- read.csv("/cloud/project/Bellabeat/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv")
```

```{r}
minuteSleep_merged <- read.csv("/cloud/project/Bellabeat/Fitabase Data 4.12.16-5.12.16/minuteSleep_merged.csv")
```

```{r}
dailyCalories_merged <- read.csv("/cloud/project/Bellabeat/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv")
```

4)	 Preview of data frames

```{r}
head(sleepDay_merged) 
```

```{r}
head(dailyActivity_merged)
```

```{r}
head(dailySteps_merged)
```

```{r}
head(minuteSleep_merged)
```

```{r}
head(dailyCalories_merged)
```


5) Data cleaning

The sleep and activity data will be most relevant to our analysis, I look for duplicates in my data to see if they should be eliminated or if they are relevant to the analysis. For the sleepDay_merged data frame, there were 6 duplicates, and they were merely repeating the number of sleep records which does not bear any relevance to my analysis, so I keep them. For the dailyActivity_merged data frame, there were no duplicates. 

```{r}

duplicated_rows <- sleepDay_merged[duplicated (sleepDay_merged[, c("TotalMinutesAsleep", "TotalTimeInBed")]), ]

```

6

```{r}
duplicated_rows <- dailyActivity_merged[duplicated(dailyActivity_merged), ]
```

0

6) Checking for nulls. There were no nulls as indicated by 0L (L refers to an integer).

```{r}
nulls_dailyActivity <- sum(is.na(dailyActivity_merged))

nulls_sleepDay <- sum(is.na(sleepDay_merged))

```

7) Checking for zeros

```{r}
zeros_dailyActivity <- apply(dailyActivity_merged == 0, 2, sum)

sum(zeros_dailyActivity)
```

There were 3765 zeros as evidenced by 3765 L's. I will not remove them as they are relevant to my analysis.

```{r}
zeros_sleepDay <- apply(sleepDay_merged == 0, 2, sum)

head(zeros_sleepDay)
```
There were no zeros.

8) First, I will merge sleepDay_merged and dailyActivity_merged into one data frame called original_df.

```{r}
original_df <- merge(sleepDay_merged, dailyActivity_merged, by = 'Id', all=FALSE)

```

9) I create a new data frame, 'new_df,' from vectors derived from 'original_df.' In 'new_df,' I will calculate the average activity across "VeryActiveMinutes," "FairlyActiveMinutes," and "LightlyActiveMinutes" columns, resulting in a new column named "average_activity." This approach maintains the integrity of the original data frame by not modifying it directly. The "average_activity" column represents the average activity for each entry within the respective row.

```{r}
new_df <- data.frame(
  VeryActiveMinutes = original_df$VeryActiveMinutes,
  FairlyActiveMinutes = original_df$FairlyActiveMinutes,
  LightlyActiveMinutes = original_df$LightlyActiveMinutes
)
```

```{r} 
new_df$average_activity <- rowMeans(new_df[,c ("VeryActiveMinutes", "FairlyActiveMinutes", "LightlyActiveMinutes")], na.rm = TRUE)

```

10)	I then add the original_df and the new_df data frames into one data frame. Rather than merging these data frames, which rely on a shared column name, I concatenated these data frames horizontally based on the shared number of rows.

```{r}
joined_df <- cbind(original_df, new_df)

head(joined_df) 

```



11) I remove duplicate columns so I don’t come up against any issues when I seek out the distinct users and their average activity. 

```{r}
joined_df <- joined_df %>%
  select(-matches("VeryActiveMinutes|FairlyActiveMinutes|LightlyActiveMinutes"))

head(joined_df)
```

12) Next, I find the distinct number of users for average activity per user ‘Id,’ rather than the average activity per entry/row as was previously calculated.

```{r}
average_data <- joined_df %>%
  group_by(Id) %>%
  summarize(avg_activity = mean(average_activity, na.rm = TRUE))

print(average_data)
```

13) I rename the average_data data frame into a data frame called averageActivity_df.

```{r}
averageActivity_df <- average_data
```


# Analyze

1) Next, I calculate the sleep efficiency as measured by Sleep Efficiency (%) = (Time Slept/ Time Spent in Bed) * 100. This statistic will be a key indicator that refers to how efficiently one is sleeping. A higher percentage will indicate that the individual has spent more time sleeping, whilst a lower percentage will indicate more restless sleep. This measurement is used typically in sleep studies and can be valuable. This sleep efficiency will be calculated for each row/entry.

```{r}
joined_df$SleepEfficiency <- (joined_df$TotalMinutesAsleep / joined_df$TotalTimeInBed) *   100
```

2) I find the average sleep efficiency for each distinct user based on their multiple entries.  

```{r}
average_SleepEfficiency <- joined_df  %>%
group_by(Id)  %>%
summarize(avg_SleepEfficiency = mean(SleepEfficiency, na.rm = TRUE))

print(average_SleepEfficiency)
```

3) I merge the averageActivity_df data frame with the avg_SleepEfficiecny into a data frame called merged_df. 

```{r}
merged_df <-merge(averageActivity_df,average_SleepEfficiency)

```

4) I find the correlation between average activity and the average sleep efficiency data.

```{r}
correlation_coefficient <- cor(merged_df$avg_activity, merged_df$avg_SleepEfficiency)

print(paste("Correlation Coefficient: ", round(correlation_coefficient, 4)))

```
A correlation coefficient of 0.1005 is a weak correlation. 

5) Next, I will graph the correlation between average activity and sleep efficiency data.

```{r}
plot_1 <- ggplot(merged_df, aes(x = avg_activity, y = avg_SleepEfficiency)) +
    geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") + 
    labs(title = "Average Activity vs  Average Sleep Efficiency",
         x = "Average Activity",
         y = "Average Sleep Efficiency") + 
  geom_text(aes(label = sprintf("Correlation = %.2f", cor(avg_activity, avg_SleepEfficiency))),
            x = min(merged_df$avg_activity), y = max(merged_df$avg_SleepEfficiency), hjust = 0, vjust = 1, color = "blue")

print(plot_1)

```

6) I will calculate the correlation between "TotalTimeSpentinBed" and "TotalMinutesAsleep." A positive correlation signifies a simultaneous increase in both variables, while a negative correlation indicates an inverse relationship. The correlation coefficient ranges from -1 to +1, signifying the strength of the correlation. This analysis will help determine if spending more non-sleep time in bed is negatively associated with actual sleep duration. A strong negative correlation might suggest a need for sleep hygiene principles, although such principles are beneficial regardless of the correlation.

```{r}

total_minutes_asleep <- original_df$TotalMinutesAsleep

total_time_in_bed <- original_df$TotalTimeinBed

correlation <- cor(original_df$TotalMinutesAsleep, original_df$TotalTimeInBed)

print(correlation)

```

A correlation coefficient of 0.93 is strong and indicates a positive relationship. This suggests that as one variable increases, the other also increases. Therefore, it seems that this sample may not significantly benefit from sleep pattern support through the Bella beat Time device. 

7) I will graph this correlation to show a visual representation for stakeholders to gain quick insights into the relationship between the two variables. 

```{r}
	
 Plot_2 <- ggplot(original_df, aes(x = TotalMinutesAsleep, y = TotalTimeInBed)) +
     geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") + labs(title = "Time Slept vs. Time in Bed correlation",
          x = "Total Minutes Asleep",
          y = "Total Time in Bed") +
       annotate("text", x=min(original_df$TotalMinutesAsleep), y = max(original_df$TotalTimeInBed),label = sprintf("Correlation = %.2f", correlation),
             hjust = 0, vjust =1, color ="blue") 
 print(Plot_2)
```

8) Next, I will calculate the standard deviation of the total minutes asleep, as a measure of sleep consistency or rather “Variability in Sleep Patterns.” A low standard deviation would indicate a higher degree of sleep consistency.


9) Before I do this I will simplify the long Id numbers by creating a temporary mapping for Id values into one-digit numbers, and merge the mapping with the original data frame.

```{r}
id_mapping <- data.frame(
  Id = unique(original_df$Id),
  Short_Id = 1:length(unique(original_df$Id))
)
```


```{r}

original_df_mapped <- original_df %>%
  left_join(id_mapping, by = "Id")
```

10) Here, I calculate the mean and standard deviation(sd) for "TotalMinutesAsleep" using the mapped Id values. I calculate the average time spent sleeping for each user (each users total recorded sleep entries) as depicted in the AvgSleep column in the original_df_stats data frame. The standard deviation reflects the variability of each individual users sleep patterns. 


```{r}
original_df_stats <- original_df_mapped %>%
  group_by(Short_Id) %>%
  reframe(
    AvgSleep = mean(TotalMinutesAsleep, na.rm = TRUE),
    StdevSleep = sd(TotalMinutesAsleep, na.rm = TRUE),
    ZScoreSleep = scale(TotalMinutesAsleep, center = mean(TotalMinutesAsleep, na.rm = TRUE), scale = sd(TotalMinutesAsleep, na.rm = TRUE))
  )

```

```{r}

Plot_3 <- ggplot(original_df_stats, aes(x = Short_Id, y = StdevSleep)) +
  geom_point(aes(y = AvgSleep), color = "blue", size = 3) +
  geom_errorbar(aes(ymin = AvgSleep - StdevSleep, ymax = AvgSleep + StdevSleep), 
                width = 0.25, color = "red") +
  labs(title = "Sleep Consistency per Id", x = "Id", y = "Standard Deviation of Sleep") +
  theme_minimal()

print(Plot_3)

```


```{r} 
str(original_df_stats$StdevSleep)
```

11) Previously, the standard deviation of each user is calculated. Next, I will calculate the mean of all 24 distinct Id's average sleep.

```{r}
mean_avg_sleep <- mean(original_df_stats$AvgSleep)

print(mean_avg_sleep) 
```
12) Here I calculate the standard deviation for all the participants based on their average sleep (AvgSleep). 

```{r}
sd_avg_sleep <- sd(original_df_stats$AvgSleep, na.rm = TRUE)

print(sd_avg_sleep)
```

13) Next, I calculate the NumSDFromMean which calculates a standardized measure for each user's sleep average. It describes how far away it is from the overall mean of the data frame. In other words, it describes the relative position each user holds relative to everyone's mean.

```{r}
original_df_stats <- original_df_stats %>%
mutate(NumSDFromMean = (AvgSleep - mean_avg_sleep) / sd_avg_sleep)

```


14) I aggregate the data for each distinct user Id.
```{r}
aggregated_z_scores <- original_df_stats %>%
  group_by(Short_Id) %>%
  summarise(
    AvgSleep = mean(AvgSleep),
    StdevSleep = mean(StdevSleep),
    ZScoreSleep = mean(ZScoreSleep),
    NumSDFromMean = mean(NumSDFromMean)
  )

print(aggregated_z_scores) 
view(aggregated_z_scores)
```

15) I notice an NaN value in the data frame, so I retain the 0 in the ZScoreSleep column. 

```{r}

aggregated_z_scores$ZScoreSleep <- replace(aggregated_z_scores$ZScoreSleep, 
                                           is.na(aggregated_z_scores$ZScoreSleep) & aggregated_z_scores$StdevSleep == 0,
                                           0)

```

16) I plot the Z-scores of each user, to show how much variability (standard deviation) or consistency there is in their sleep patterns in a standardized manner.

```{r}

Plot_3A <- ggplot(aggregated_z_scores, aes(x = Short_Id, y = StdevSleep)) +
  geom_point(aes(y = AvgSleep), color = "blue", size = 3) +
  geom_errorbar(aes(ymin = AvgSleep - StdevSleep, ymax = AvgSleep + StdevSleep), 
                width = 0.25, color = "red") +
  geom_text(aes(label = paste("Z =", round(NumSDFromMean, 2)), y = AvgSleep), 
            vjust = -1, color = "black", size = 3) +
  labs(title = "Sleep Consistency per Id with Standardized Z-scores", 
       x = "Id", y = "Standard Deviation of Sleep") +
  theme_minimal()

print(Plot_3A)
```

17) Then, I graph the standard deviations for Id's relative to the group mean to show how much average sleep of users differs from the group mean.

```{r}

aggregated_z_scores$NumSDToGroupMean <- (aggregated_z_scores$AvgSleep - mean(aggregated_z_scores$AvgSleep)) / sd(aggregated_z_scores$AvgSleep)


Plot_4 <- ggplot(aggregated_z_scores, aes(x = jitter(1:nrow(aggregated_z_scores)), y = AvgSleep, color = NumSDToGroupMean)) +
  geom_point(size = 3) +
  geom_hline(yintercept = mean(aggregated_z_scores$AvgSleep), linetype = "dashed", color = "green", size = 1) +
  labs(title = "Number of Standard Deviations from the Group Mean",
       x = "Id",
       y = "Average Sleep",
       color = "Standardized Z-scores to Group Mean") +
  scale_color_gradient(low = "blue", high = "red", breaks = seq(-5, 5, by = 1), labels = seq(-5, 5, by = 1)) +
  theme_minimal()

print(Plot_4)

```

18) Here I plot the AvgSleep and standard deviation per distinct Id relative to the entire groups mean. Then I divide them into groupings and plot them to show to what degree they differ. 


```{r}
aggregated_z_scores$SDCategory <- cut(aggregated_z_scores$NumSDToGroupMean,
                                      breaks = c(-Inf, -2, -1, 0, 1, 2, Inf),
                                      labels = c("<= -2 SD", "-2 to -1 SD", "-1 to 0 SD", "0 to 1 SD", "1 to 2 SD", ">= 2 SD"),
                                      include.lowest = TRUE)
```


```{r} 
Plot_4A <- ggplot(aggregated_z_scores, aes(x = SDCategory, fill = SDCategory)) +
  geom_bar() +
  labs(title = "Distribution of Standardized Z-scores to Group Mean",
       x = "Standard Deviation Categories",
       y = "Frequency",
       fill = "Standard Deviation Categories") +
  scale_fill_manual(values = c("#A30061", "#FF99AC", "#FFD6E6", "#FFD6E6", "#A30061", "#A30061")) +
  theme_minimal()

print(Plot_4A)
```

19) Here we can see that majority of Id's fall within the -1 to +1 range of standard deviations. Thus, we can conclude that most participants don't vary widely from other pariticipants in the survey. This could be due to the similarities of the demographic who uses products like Fitbit, for instance.



# Share 

Graph 1) The relationship between average activity and sleep efficiency of survey respondents as evidenced by a 0.1 correlation coeffecient suggests that there isn't a strong relationship although they both move in a positive direction. Although average activity seems to be related to sleep efficiency which might include factors like onset of sleep, it's not clear how. To reiterate sleep efficiency is time spent sleeping/ time in bed * 100. Therefore, I speculate that that there are bedtime routines,behaviors, and perhaps even dispositional factors that are seemingly unrelated to the individuals average level of daily activity. 

Graph 2) The second insight that I draw is regarding the sleep efficiency as measured by the amount of time slept divided by the time spent in bed multiplied by a hundred, wherein a greater percentage indicates a smaller gap between these two measures. The correlation between the time spent sleep versus the time spent in bed was 0.93 meaning that most data points fell in the 90-100 % range, yet there are still improvements that can close this gap. Any gaps between time spent sleeping versus total time spent in bed could be due to an inability to sleep or confounding factors, like those who eat, work, or read in bed. This could be giving them a lower sleep efficiency score.

Graph 3) Here I calculated the users' standard deviation from their own average sleep score and standardized it through z-scores. Error bars are used to represent the variability around the mean total minutes asleep for each user. The length of the error bars illustrates the standard deviation, providing visual insights into the dispersion of the data points. 

Graph 3A) Here, I provided the actual numerical z-scores. It is visually clear that there are 3-4 outliers that have high a z-score meaning a greater variability in their sleep consistency. The smaller z scores (as integers) have less variability in their average sleep. This means that for most participants, their sleep from night to night is quite consistent. 


Graph 4) In this plot, I visually represent how the average sleep differs from the mean sleep of the entire group of particpants. On this plot, only 4 means are outliers.  

4A) Here, I divide these average sleep scores into different standard deviation brackets, showing that more than half of participants fall between -1 to + 1 of the mean of the entire group. Therefore, I concluded that participants didn't very widely from one another. This could be because most participants who own a Fitbit type device perhaps are individuals who are conscientious and intentional about their sleep and health habits. Therefore, they sleep diligently and converge in terms of their average sleep amounts. Furthermore, they share demographic and perhaps psychological factors that make them similar.


Limitations:

As I mentioned in the introduction, there are limitations to the data. The first limitation being that the number of distinct participants were 24 which is below the minimum 30 sample size threshold for data to be generalizable. So the degree that I can generalize from my analysis to Bellabeat users is limited. The second limitation is that the sex of participants in the data I analyzed was not specified and therefore the the recommendations that Bellabeat wants for it's female customers are limited. The third limitation is that the Fitbit devices that particpants used were not the same. Therefore is a lack of consistency between participants. To create a more insightful and nuanced analysis, it would be helpful to knwo demographic data like sex and menstrual cycle data as well as data about participants personality/disposition. This would allow for more targeted recommendations. 

# Act

Even though the participants have high sleep efficiency scores, mostly in the 90-100% range, sleep hygiene practices would help bridge the gap between the time spent in bed and time actually spent sleeping. 
Sleep hygiene practices include relegating all non-sleep activities outside the parameters of the physical bed. This would result in a greater sleep efficiency percentage as well as likely improve the quality of sleep and the onset of sleep. I would recommend creating reminders on the app for sleep time, wake times and sleep routines such as tracking bedtime rituals according to sleep hygiene principles.The recommendations that I provide will be three fold. 

# Recommendations 

1) My first recommendation will be underpinned by the principle of social influence. I recommend Bellabeat's stakeholders to recommend their "Time (Fitbit)" users to share the their progress as seen on the app to social media, as well as engage in group challenges. These challenged would be based on meeting goals related to sleeping early, sleeping certain amounts of time, and adhering to sleep hygiene principles.

2) The second recommendation will be underpinned by the concept of positive reinforcement. Users will be earn rewards for meeting certain sleep goals. The manner in which these rewards however will be given will be based on the psychological principle of the partial rewards schedule, meaning users will not receive a reward in a consistent manner. More specifically, the variable-ratio reward schedule stipulates that users will receive rewards at random ratios upon completing specific goals, rather than in a predictable and consistent way. This form of partial reward scheduling has a tendency to make users become more "addicted" so to speak. It's the same principle that underpins slot machines at casinos and what accounts for their addictivness. The casino go-er keeps playing, ready to win at any give possible time. This means that the app will provide rewards in response to random ratios of goals/tasks and thus adherence to the principles of the app. The random reward creates a stronger adherence to the behavior. 

3) The third recommendation will be based on cognitive behavioral strategies, like self-monitoring which promotes agentic behavior over one's health patterns. So, in response to reminders on the app which cue or prime users, consumer take accountability for their sleep habits. Subsequently, they are more likely to adhere to their positive sleep changes.
 
 
 
 
 
#Citations

https://www.sleepfoundation.org/sleep-hygiene

https://www.kaggle.com/datasets/arashnic/fitbit









